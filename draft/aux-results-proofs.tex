\section{Auxiliary Results with Proofs}
\label{sec:auxiliary_results_with_proofs}
\begin{lemma}[Kinding]
  \label{lemma:kinding}
  \begin{enumR}
  \item[]
  \item If $[[G |- A ~ B]]$, then $[[G |- A : *]]$ and $[[G |- B : *]]$.
  \item If $[[G |- A <~ B]]$, then $[[G |- A : *]]$ and $[[G |- B : *]]$.
  \item If $[[G |- t : A]]$, then $[[G |- A : *]]$.
  \end{enumR}
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction the form of each
  assumed judgment.
\end{proof}

\begin{lemma}[Strengthening for Kinding]
  \label{lemma:strengthening_for_kinding}
  If $[[G, x : A |- B : *]]$, then $[[G |- B : *]]$.
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on the form of $[[G, x : A |- B : *]]$.
\end{proof}

\begin{lemma}[Inversion for Type Precision]
  \label{lemma:inversion_of_type_precision}
  Suppose $[[G |- A : *]]$, $[[G |- B : *]]$, and $[[A <= B]]$.  Then:
  \begin{enumR}
  \item if $[[A]] = [[?]]$, then $[[G |- B <~ SL]]$.
  \item if $[[A]] = [[A1 -> B1]]$, then
    $[[B]] = [[?]]$ and $[[G |- A <~ SL]]$, or $[[B]] = [[A2 -> B2]]$, $[[A1 <= A2]]$, and $[[B1 <= B2]]$.
  \item if $[[A]] = [[A1 x B1]]$, then
    $[[B]] = [[?]]$ and $[[G |- A <~ SL]]$, or $[[B]] = [[A2 x B2]]$, $[[A1 <= A2]]$, and $[[B1 <= B2]]$.
  \item if $[[A]] = [[List A1]]$, then
    $[[B]] = [[?]]$ and $[[G |- A <~ SL]]$, or $[[B]] = [[List A2]]$ and $[[A1 <= A2]]$.
  \item if $[[A]] = [[Forall (X <: A1).B1]]$, then
    $[[B]] = [[Forall (X <: A1).B1]]$ and $[[B1 <= B2]]$.
  \end{enumR}
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on the form of $[[A <= B]]$.
\end{proof}

\begin{lemma}[Inversion for Term Precision]
  \label{lemma:inversion_of_term_precision}
  Suppose $[[t <= t']]$. Then:
  \begin{enumR}
  \item if $[[t]] = [[succ t1]]$, then $[[t']] = [[succ t2]]$ and $[[t1 <= t2]]$.
  \item if $[[t]] = [[(case t1 of 0 -> t2, (succ x) -> t3)]]$, then
    $[[t']] = [[(case t1' of 0 -> t2', (succ x) -> t3')]]$, $[[t1 <= t1']]$, $[[t2 <= t2']]$, and $[[t3 <= t3']]$.
  \item if $[[t]] = [[(t1,t2)]]$, then $[[t']] = [[(t1',t2')]]$, $[[t1 <= t1']]$, and $[[t2 <= t2']]$.
  \item if $[[t]] = [[fst t1]]$, then $[[t']] = [[fst t1']]$ and $[[t1 <= t1']]$.
  \item if $[[t]] = [[snd t1]]$, then $[[t']] = [[snd t1']]$ and $[[t1 <= t1']]$.
  \item if $[[t]] = [[t1::t2]]$, then $[[t']] = [[t1'::t2']]$, $[[t1 <= t1']]$, and $[[t2 <= t2']]$.
  \item if $[[t]] = [[(case t1 of [] -> t2, (x::y) -> t3)]]$, then
    $[[t']] = [[(case t1' of [] -> t2', (x::y) -> t3')]]$, $[[t1 <= t1']]$, $[[t2 <= t2']]$, and $[[t3 <= t3']]$.
  \item if $[[t]] = [[\x:A1.t1]]$, then $[[t']] = [[\x:A1.t1']]$ and $[[t1 <= t1']]$.
  \item if $[[t]] = [[(t1 t2)]]$, then $[[t']] = [[(t1' t2')]]$, $[[t1 <= t1']]$, and $[[t2 <= t2']]$.
  \item if $[[t]] = [[Lam X <: A1.t1]]$, then $[[t']] = [[Lam X <: A1.t1']]$ and $[[t1 <= t1']]$.
  \item if $[[t]] = [[ [A]t1]]$, then $[[t']] = [[ [A]t1']]$ and $[[t1 <= t1']]$.
  \end{enumR}
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on the form of $[[t <= t']]$.
\end{proof}

\begin{lemma}[Inversion for Type Consistency]
  \label{lemma:inversion_of_type_consistency}
  Suppose $[[G |- A ~ B]]$. Then:
  \begin{enumR}
  \item if $[[A]] = [[?]]$, then $[[G |- B <~ SL]]$.
  \item if $[[A]] = [[List A']]$, then $[[B]] = [[?]]$ and $[[G |- A <~ SL]]$, or
    $[[B]] = [[List B']]$ and $[[G |- A' ~ B']]$.
  \item if $[[A]] = [[A1 -> B1]]$, then $[[B]] = [[?]]$ and $[[G |- A <~ SL]]$, or
    $[[B]] = [[A2 -> B2]]$, $[[G |- A2 ~ A1]]$, and $[[G |- B1 ~ B2]]$.
  \item if $[[A]] = [[A1 -> B1]]$, then $[[B]] = [[?]]$ and $[[G |- A <~ SL]]$, or
    $[[B]] = [[A2 -> B2]]$, $[[G |- A2 ~ A1]]$, and $[[G |- B1 ~ B2]]$.
  \item if $[[A]] = [[A1 x B1]]$, then $[[B]] = [[?]]$ and $[[G |- A <~ SL]]$, or
    $[[B]] = [[A2 x B2]]$, $[[G |- A1 ~ A2]]$, and $[[G |- B1 ~ B2]]$.
  \item if $[[A]] = [[Forall (X <: A1).B1]]$, then $[[B]] = [[Forall (X <: A1).B2]]$ and $[[G, X <: A1 |- B1 ~ B2]]$.
  \end{enumR}
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on the the form of $[[G |- A ~ B]]$.
\end{proof}

\begin{lemma}[Inversion for Consistent Subtyping]
  \label{lemma:inversion_of_consistent_subtyping}
  Suppose $[[G |- A <~ B]]$. Then:
  \begin{enumR}
  \item if $[[A]] = [[?]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ or $[[G |- B <~ SL]]$.
  \item if $[[A]] = [[X]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ and $[[G |- A : *]]$, or $[[X <: B' elem G]]$ and $[[G |- B' ~ B]]$.
  \item if $[[A]] = [[Nat]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ and $[[G |- A : *]]$, or $[[B]] = [[SL]]$.
  \item if $[[A]] = [[Unit]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ and $[[G |- A : *]]$, or $[[B]] = [[SL]]$.
  \item if $[[A]] = [[List A1]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ and $[[G |- A : *]]$, $[[B]] = [[SL]]$ and $[[G |- A1 <~ SL]]$,
    or $[[B]] = [[List A1']]$ and $[[G |- A1 <~ A1']]$.
  \item if $[[A]] = [[A1 -> B1]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ and $[[G |- A : *]]$, $[[B]] = [[SL]]$, $[[G |- A1 <~ SL]]$ and
    $[[G |- B1 <~ SL]]$, or $[[B]] = [[A1' -> B1']]$, $[[G |- A1' <~ A1]]$, and $[[G |- B1 <~ B1']]$.
  \item if $[[A]] = [[A1 x B1]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ and $[[G |- A : *]]$, $[[B]] = [[SL]]$, $[[G |- A1 <~ SL]]$ and
    $[[G |- B1 <~ SL]]$, or $[[B]] = [[A1' x B1']]$, $[[G |- A1 <~ A1']]$, and $[[G |- B1 <~ B1']]$.
  \item if $[[A]] = [[Forall (X <: A1).B1]]$, then
    $[[B]] = [[A]]$ and $[[G |- A : *]]$, $[[B]] = [[Top]]$ and $[[G |- A : *]]$,
    or $[[B]] = [[Forall (X <: A1).B1']]$ and $[[G, X <: A1 |- B1 <~ B1']]$.
  \end{enumR}
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on the the form of $[[G |- A <~ B]]$.
\end{proof}

\begin{lemma}[Symmetry for Type Consistency]
  \label{lemma:symmetry_for_type_consistency}
  If $[[G |- A ~ B]]$, then $[[G |- B ~ A]]$.
\end{lemma}
\begin{proof}
  This holds by straightforward induction on the form of $[[G |- A ~ B]]$.
\end{proof}

\begin{lemma}
  \label{lemma:consistent-subtyping-2}
  If $<<G |- A <: B>>$, then $[[G |- A <~ B]]$.
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on $<<G |- A <: B>>$.
\end{proof}

\begin{lemma}
  \label{lemma:consistent-subtyping-3}
  if $[[G |- A ~ B]]$, then $[[G |- A <~ B]]$.
\end{lemma}
\begin{proof}
  By straightforward induction on $[[G |- A ~ B]]$.
\end{proof}

\begin{lemma}[Type Precision and Consistency]
  \label{lemma:type_precision_and_consistency}
  Suppose $[[G |- A : *]]$ and $[[G |- B : *]]$.  Then
  if $[[A <= B]]$, then $[[G |- A ~ B]]$.
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on $[[A <= B]]$.
\end{proof}

\begin{corollary}[Type Precision and Subtyping]
  \label{corollary:type_precision_and_subtyping}
  Suppose $[[G |- A : *]]$ and $[[G |- B : *]]$.  Then
  if $[[A <= B]]$, then $[[G |- A <~ B]]$.
\end{corollary}
\begin{proof}
  This easily follows from the previous two lemmas.
\end{proof}

\begin{lemma}
  \label{lemma:type_precision_triangle_consistenty}
  Suppose $[[G |- A : *]]$, $[[G |- B : *]]$, and $[[G |- C : *]]$.
  If $[[A <= B]]$ and $[[A <= C]]$, then $[[G |- B ~ C]]$.
\end{lemma}
\begin{proof}
  It must be the case that either $[[B <= C]]$ or $[[C <= B]]$, but in both cases
  we know $[[G |- B ~ C]]$ by Lemma~\ref{lemma:type_precision_and_consistency}.
\end{proof}

\begin{lemma}[Transitivity for Type Precision]
  \label{lemma:transitivity_for_type_precision}
  If $[[A <= B]]$ and $[[B <= C]]$, then $[[A <= C]]$.
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on $[[A <= B]]$ with
  a case analysis over $[[B <= C]]$.
\end{proof}

\begin{lemma}
  \label{lemma:type_consistency_to_type_precision}
  If $[[G |- A ~ B]]$, then $[[A <= B]]$ or $[[B <= A]]$.
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction over $[[G |- A ~ B]]$.
\end{proof}

\begin{lemma}
  \label{lemma:cons_subtype_to_type_pre}
  If $[[G |- A <~ B]]$ and $[[A <= A']]$, then $[[B <= A']]$ or $[[A' <= B]]$.
\end{lemma}
\begin{proof}
  Suppose $[[G |- A <~ B]]$ and $[[A <= A']]$.  The former implies
  that $[[A <= B]]$ or $[[B <= A]]$ by
  Lemma~\ref{lemma:consistent-subtyping-1} and
  Lemma~\ref{lemma:type_consistency_to_type_precision}.  At this
  point the result easily follows.
\end{proof}

\begin{lemma}
  \label{lemma:fun_type_pre}
  Suppose $[[A <= B]]$.  Then
  \begin{enumR}
  \item If $[[nat(A) = Nat]]$, then $[[nat(B) = Nat]]$.    
  \item If $[[list(A) = List C]]$, then $[[list(B) = List C']]$ and $[[C <= C']]$.
  \item If $[[fun(A) = A1 -> A2]]$, then $[[fun(B) = A1' -> A2']]$, $[[A1 <= A1']]$, and $[[A2 <= A2']]$.
  \end{enumR}
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on $[[A <= B]]$.
\end{proof}

\begin{lemma}
  \label{lemma:type_cons_type_pre_2}
  If $[[G |- A ~ B]]$, $[[G |- C : *]]$, and $[[A <= C]]$, then $[[G |- C ~ B]]$.
\end{lemma}
\begin{proof}
  Suppose $[[G |- A ~ B]]$ and $[[A <= C]]$.  Then we know
  that $[[A <= B]]$ or $[[B <= A]]$.  If the former, then
  we know that $[[G |- C ~ B]]$.  If the latter, then
  we obtain $[[B <= C]]$ by transitivity, and $[[G |- B ~ C]]$
  which implies that $[[G |- C ~ B]]$ by symmetry.
\end{proof}

\begin{lemma}
  \label{lemma:type_cons_ctx_pre}
  If $[[G' Ok]]$, $[[G <= G']]$ and $[[G |- A ~ B]]$, then $[[G' |- A ~ B]]$.
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on $[[G |- A ~ B]]$. 
\end{proof}

\begin{lemma}[Subtyping Context Precision]
  \label{lemma:subtyping_context_precision}
  If $[[G |- A <~ B]]$ and $[[G <= G']]$, then $[[G' |- A <~ B]]$.
\end{lemma}
\begin{proof}
  Context precision does not manipulate the bounds on type variables, and thus,
  with respect to subtyping $[[G]]$ and $[[G']]$ are essentially equivalent.
\end{proof}

\begin{lemma}[Simply Typed Consistent Types are Subtypes of $[[SL]]$]
  \label{lemma:simply_typed_consistent_types_are_subtypes}
  If $[[G |- A <~ SL]]$ and $[[G |- A ~ B]]$, then $[[G |- B <~ SL]]$.
\end{lemma}
\begin{proof}
  This holds by straightforward induction on the form of $[[G |- A <~ SL]]$.
\end{proof}

\begin{lemma}[Type Precision Preserves $[[SL]]$]
  \label{lemma:type_precision_preserves_SL}
  \begin{enumR}
  \item[]
  \item If $[[G |- B : *]]$, $[[G |- A <~ SL]]$ and $[[A <= B]]$, then $[[G |- B <~ SL]]$.
  \item If $[[G |- A : *]]$, $[[G |- B <~ SL]]$ and $[[A <= B]]$, then $[[G |- A <~ SL]]$.
  \end{enumR}
\end{lemma}
\begin{proof}
  Both cases follow by induction on the assumed consistent subtyping
  derivation.
\end{proof}
% subsection auxiliary_results_with_proofs (end)
