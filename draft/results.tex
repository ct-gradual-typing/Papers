\begin{lemma}[Inclusion of Bounded System F]
  \label{lemma:F-inclusion}
  Suppose $t$ is fully annotated and does not contain any applications
  of $[[box]]$ or $[[unbox]]$, and $[[A]]$ is static.  Then
  \begin{itemize}
  \item[i.] $[[G |-F t : A]]$ if and only if $\,[[G |- t : A]]$, and 
  \item[ii.] $[[t F~>* t']]$ if and only if $[[t ~>* t']]$.
  \end{itemize}
\end{lemma}
\begin{proof}
  We give proof sketches for both parts.  The interesting cases are
  the right-to-left directions of each part.  If we simply remove all
  rules mentioning the unknown type $[[?]]$ and the type consistency
  relation, and then remove $[[box]]$, $[[unbox]]$, and $[[?]]$ from
  the syntax of Surface Grady, then what we are left with is bounded
  system F.  Since $[[t]]$ is fully annotated and $[[A]]$ is static,
  then $[[G |- t : A]]$ will hold within this fragment.

  Moving on to part two, first, we know that $[[t]]$ does not contain
  any occurrence of $[[box]]$ or $[[unbox]]$ and is fully annotated.
  This implies that $[[t]]$ lives within the bounded system F fragment
  of Surface Grady. Thus, before evaluation of $[[t]]$ Surface Grady
  will apply the cast insertion algorithm which will at most insert
  applications of the identity function into $[[t]]$ producing a term
  $\widehat{[[t]]}$, but then after potentially more than one step of
  evaluation within Core Grady, those applications of the identity
  function will be $\beta$-reduced away resulting in $\widehat{[[t]]}
  \rightsquigarrow^* [[t]] \rightsquigarrow^* [[t']]$.  In addition,
  since $[[t]]$ in Surface Grady is the exact same program as $[[t]]$
  in bounded system F, then we know $[[t F~>* t']]$ will hold.
\end{proof}

\begin{lemma}[Inclusion of DTLC]
  \label{lemma:inclusion_of_dtlc}
  Suppose $[[t]]$ is a closed term of DTLC. Then
  \begin{itemize}
  \item[i.] $[[. |- |t| : ?]]$, and
  \item[ii.] $[[t D~>* t']]$ if and only if $[[|t| ~>* |t'|]]$.
  \end{itemize}
\end{lemma}
\begin{proof}
  In this case DTLC is embedded into the simply typed fragment of
  Grady, and hence, this proof is the same result proven by
  \cite{Siek:2006}, and \cite{Siek:2015}.
\end{proof}

\renewcommand{\SGradydrulePXXUName}{[[?]]}
\renewcommand{\SGradydrulePXXreflName}{\text{refl}}
\renewcommand{\SGradydrulePXXarrowName}{\to}
\renewcommand{\SGradydrulePXXprodName}{\times}
\renewcommand{\SGradydrulePXXlistName}{\mathsf{List}}
\renewcommand{\SGradydrulePXXforallName}{\forall}
\begin{figure}
  \begin{mdframed}
    \begin{mathpar}
      \SGradydrulePXXU{} \and
      \SGradydrulePXXrefl{} \and
      \SGradydrulePXXarrow{} \and
      \SGradydrulePXXprod{} \and
      \SGradydrulePXXlist{} \and
      \SGradydrulePXXforall{}      
    \end{mathpar}
  \end{mdframed}
  \caption{Type Precision}
  \label{fig:type-pre}
\end{figure}

\begin{lemma}[Subtyping and Precision]
  \label{lemma:subtyping_and_precision}
  Suppose $[[G |- A <: B]]$. Then
  \begin{itemize}
  \item[i.] if $[[A <= A']]$, then $[[G |- A' <: B']]$ for $[[B <= B']]$, and
  \item[i.] if $[[B <= B']]$, then $[[G |- A' <: B']]$ for $[[A <= A']]$.
  \end{itemize}
\end{lemma}
\begin{proof}
  This proof holds by induction on $[[G |- A <: B]]$.
  \begin{itemize}
  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXReflName{}$] {
          [[G Ok]]
        }{[[G |- A <: A]]}
      \end{math}
    \end{center}        
    \textbf{Proof of part i.} Choose $[[B']] = [[A']]$.
    
    \noindent
    \textbf{Proof of Part ii.} Choose $[[A']] = [[B']]$.

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXTransName{}$] {
          [[G |- A <: B && G |- B <: C]]
        }{[[G |- A <: C]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.} Suppose $[[A <= A']]$.  Then by part one of applying
    the induction hypothesis to $[[G |- A <: B]]$ we know that $[[G |- A' <: B']]$ for
    $[[B <= B']]$, and by part one of applying the induction hypothesis to $[[G |- B <: C]]$ and $[[B <= B']]$
    we know $[[G |- B' <: C']]$ for $[[C <= C']]$.  Thus, by transitivity of subtyping 
    we know $[[G |- A' <: C']]$ and $[[C <= C']]$.
    \noindent
    \textbf{Proof of Part ii.}  Suppose $[[B <= B']]$.  Then by applying part two of 
    the induction hypothesis to $[[G |- A <: B]]$ we know that $[[G |- A' <: B']]$ for
    $[[A <= A']]$, and by applying part one of the induction hypothesis to $[[G |- B <: C]]$ and $[[B <= B']]$
    we know $[[G |- B' <: C']]$ for $[[C <= C']]$.  Thus, by transitivity of subtyping 
    we know $[[G |- A' <: C']]$ and $[[C <= C']]$.

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXVarName{}$] {
          [[X <: B elem G && G Ok]]
        }{[[G |- X <: B]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  We know that $[[A]] = [[X]]$ and $[[A <= A']]$.  But, this implies that
    $[[A']] = [[X]]$ or $[[A']] = [[?]]$.  Choose $[[B']] = [[B]]$ in the former case, and $[[B']] = [[?]]$ in the latter.

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXUName{}$] {
          [[G Ok]]
        }{[[G |- A <: ?]]}
      \end{math}
    \end{center}    
    \textbf{Proof of part i.}
    
    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXNatSName{}$] {
          [[G Ok]]
        }{[[G |- Nat <: SL]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXUnitSName{}$] {
          [[G Ok]]
        }{[[G |- Unit <: SL]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXListSName{}$] {
          [[G |- A <: SL]]
        }{[[G |- List A <: SL]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXArrowSName{}$] {
          [[G |- A <: SL && G |- B <: SL]]
        }{[[G |- (A -> B) <: SL]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXProdSName{}$] {
          [[G |- A <: SL && G |- B <: SL]]
        }{[[G |- (A x B) <: SL]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXListName{}$] {
          [[G |- A <: B]]
        }{[[G |- (List A) <: (List B)]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXProdName{}$] {
          [[G |- A1 <: A2 && G |- B1 <: B2]]
        }{[[G |- (A1 x B1) <: (A2 x B2)]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXArrowName{}$] {
          [[G |- A2 <: A1 && G |- B1 <: B2]]
        }{[[G |- (A1 -> B1) <: (A2 -> B2)]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \item[] Case.\ \\ 
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$\SGradydruleSXXForallName{}$] {
          [[G, X <: A |- B1 <: B2]]
        }{[[G |- (Forall (X <: A).B1) <: (Forall (X <: A).B2)]]}
      \end{math}
    \end{center}
    \textbf{Proof of part i.}  

    \noindent
    \textbf{Proof of Part ii.}

  \end{itemize}
\end{proof}

\begin{theorem}[Gradual Guarantee]
  \label{thm:gradual_guarantee}
  Suppose $[[. |- t : A]]$ and $[[t <= t']]$.  Then
  \begin{itemize}
  \item[i.] $[[. |- t' : B]]$ and $[[A <= B]]$,
  \item[ii.] if $[[t ~>* v]]$, then $[[t' ~>* v']]$ and $[[v <= v']]$,
  \item[iii.] if $[[t ^]]$, then $[[t' ^]]$,
  \item[iv.] if $[[t' ~>* v']]$, then $[[t ~>* v]]$ where $[[v <= v']]$, or $<<t ~>* error>>$, and
  \item [v.] if $[[t' ^]]$, then $[[t ^]]$ or $<<t ~>* error>>$.
  \end{itemize}
\end{theorem}
\begin{proof}
  \textbf{Part i}. This case holds by induction on $[[. |- t : A]]$,
  and is fairly straightforward.  We only consider the two non-trivial
  cases.
  \begin{itemize}
  \item[] Case.
    \[
    \SGradydruleTXXapp{}
    \]
    
  \item[] Case.
    \[
    \SGradydruleTXXSub{}
    \]
    
  \end{itemize}

\end{proof}
